<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ FileName }} - File Stream Player</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo i {
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Desktop only elements */
        .desktop-only {
            display: flex;
        }
        
        /* Mobile-specific player styles */
        @media (max-width: 768px) {
            .desktop-only {
                display: none !important;
            }
            
            .custom-controls {
                padding: 30px 10px 10px;
            }
            
            .controls-row {
                flex-wrap: nowrap;
                gap: 5px;
                justify-content: space-between;
            }
            
            .controls-left {
                gap: 8px;
                flex: 1;
            }
            
            .controls-right {
                gap: 8px;
            }
            
            /* Hide skip buttons on mobile - users can double tap */
            #skipBackBtn, #skipForwardBtn {
                display: none !important;
            }
            
            .control-btn {
                padding: 8px;
                font-size: 1.1rem;
                min-width: 40px;
                min-height: 40px;
            }
            
            .play-btn {
                font-size: 1.4rem;
            }
            
            .volume-control {
                display: none !important;
            }
            
            .time-display {
                font-size: 0.8rem;
                white-space: nowrap;
            }
            
            .settings-menu {
                right: 0;
                bottom: 100%;
                min-width: 180px;
                max-height: 70vh;
            }
            
            .shortcuts-hint {
                display: none;
            }
        }
        
        /* Fullscreen mode mobile adjustments */
        .player-container:fullscreen .custom-controls,
        .player-container:-webkit-full-screen .custom-controls {
            padding: 60px 20px 20px;
        }
        
        .player-container:fullscreen .control-btn,
        .player-container:-webkit-full-screen .control-btn {
            min-width: 50px;
            min-height: 50px;
            font-size: 1.4rem;
        }

        /* Video Player Container */
        .player-container {
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 16/9;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .video-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
            background: #000;
        }

        /* Custom Controls */
        .custom-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 60px 15px 15px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .player-container:hover .custom-controls,
        .custom-controls.active {
            opacity: 1;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            transition: height 0.2s;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }

        .progress-bar:hover {
            height: 8px;
        }
        
        @media (max-width: 768px) {
            .progress-bar {
                height: 8px;
                padding: 10px 0;
                margin: -10px 0;
                background-clip: content-box;
            }
        }

        .progress-filled {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 5px;
            position: relative;
            width: 0%;
        }

        .progress-filled::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .progress-bar:hover .progress-filled::after {
            opacity: 1;
        }

        .buffered-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
        }

        /* Control Buttons */
        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .controls-left, .controls-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .control-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
            min-width: 44px;
            min-height: 44px;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.1);
        }
        
        .control-btn:active {
            background: rgba(255,255,255,0.2);
            transform: scale(0.95);
        }

        .play-btn {
            font-size: 1.5rem;
        }

        /* Time Display */
        .time-display {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.9);
            font-variant-numeric: tabular-nums;
        }

        /* Volume Control */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider {
            width: 0;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: width 0.2s;
            overflow: hidden;
        }

        .volume-control:hover .volume-slider {
            width: 80px;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Speed Control */
        .speed-control {
            position: relative;
        }

        .speed-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: rgba(28, 28, 28, 0.95);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 120px;
            display: none;
            backdrop-filter: blur(10px);
        }

        .speed-menu.active {
            display: block;
        }
        
        /* Settings Menu */
        .settings-control {
            position: relative;
        }
        
        .settings-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            padding: 10px 0;
            display: none;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        
        .settings-menu.active {
            display: block;
        }
        
        .settings-section {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .settings-section:last-child {
            border-bottom: none;
        }
        
        .settings-title {
            padding: 8px 15px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .settings-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.9rem;
        }
        
        .settings-option:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .settings-option.active {
            background: rgba(102, 126, 234, 0.3);
            color: #667eea;
        }
        
        .settings-option.active::before {
            content: '‚úì ';
        }

        .speed-option {
            padding: 8px 16px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.9rem;
        }

        .speed-option:hover {
            background: rgba(255,255,255,0.1);
        }

        .speed-option.active {
            color: #667eea;
        }

        /* Center Play Button */
        .center-play {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(0,0,0,0.7);
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s;
        }

        .center-play.show {
            opacity: 1;
        }

        .center-play:hover {
            background: rgba(102, 126, 234, 0.8);
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* Skip Indicator */
        .skip-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.7);
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .skip-indicator.left {
            left: 20%;
        }

        .skip-indicator.right {
            right: 20%;
        }

        .skip-indicator.show {
            opacity: 1;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* File Info Card */
        .info-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .info-card h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-name {
            font-size: 1rem;
            font-weight: 600;
            word-break: break-word;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .file-details {
            display: grid;
            gap: 10px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .detail-label {
            color: rgba(255,255,255,0.6);
        }

        .detail-value {
            color: #fff;
            font-weight: 500;
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            border: none;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .action-btn.secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .action-btn.secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        .action-btn.full-width {
            grid-column: span 2;
        }

        /* External Players */
        .external-players h3 {
            margin-bottom: 15px;
        }

        .player-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            text-decoration: none;
            color: #fff;
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .player-link:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .player-link img {
            width: 28px;
            height: 28px;
            border-radius: 6px;
        }

        .player-link span {
            flex: 1;
        }

        .player-link i {
            color: rgba(255,255,255,0.5);
        }

        /* Disclaimer */
        .disclaimer {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 15px;
        }

        .disclaimer h4 {
            color: #ffc107;
            font-size: 0.9rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .disclaimer p {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
            line-height: 1.5;
        }

        /* Support Link */
        .support-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: linear-gradient(135deg, #0088cc, #00a1e4);
            border-radius: 12px;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }

        .support-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 136, 204, 0.4);
        }

        /* Share Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 16px;
            padding: 25px;
            width: 90%;
            max-width: 450px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 1.2rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .share-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .share-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px 10px;
            border-radius: 12px;
            text-decoration: none;
            color: #fff;
            transition: all 0.2s;
        }

        .share-btn:hover {
            transform: translateY(-3px);
        }

        .share-btn i {
            font-size: 1.5rem;
        }

        .share-btn span {
            font-size: 0.75rem;
        }

        .share-btn.whatsapp { background: #25d366; }
        .share-btn.telegram { background: #0088cc; }
        .share-btn.twitter { background: #1da1f2; }
        .share-btn.facebook { background: #1877f2; }

        .copy-link {
            display: flex;
            gap: 10px;
        }

        .copy-link input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 0.9rem;
        }

        .copy-link button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-weight: 500;
        }

        /* Loading Spinner */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Keyboard Shortcuts */
        .shortcuts-hint {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.5);
            text-align: center;
            padding: 10px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0,0,0,0.9);
            color: #fff;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 1001;
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 10px 0;
            }

            .logo {
                font-size: 1.2rem;
            }

            .controls-left, .controls-right {
                gap: 8px;
            }

            .control-btn {
                font-size: 1rem;
                padding: 6px;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .action-btn.full-width {
                grid-column: span 1;
            }

            .share-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-play-circle"></i>
                File Stream Player
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Video Player -->
            <div class="player-section">
                <div class="player-container" id="playerContainer">
                    <div class="video-wrapper">
                        <video id="videoPlayer" preload="metadata">
                            <source src="{{ StreamURL }}" type="{{ MimeType }}">
                            Your browser does not support the video tag.
                        </video>

                        <!-- Loading Overlay -->
                        <div class="loading-overlay" id="loadingOverlay">
                            <div class="spinner"></div>
                        </div>

                        <!-- Center Play Button -->
                        <button class="center-play show" id="centerPlay">
                            <i class="fas fa-play"></i>
                        </button>

                        <!-- Skip Indicators -->
                        <div class="skip-indicator left" id="skipBackIndicator">
                            <i class="fas fa-backward"></i> 10s
                        </div>
                        <div class="skip-indicator right" id="skipForwardIndicator">
                            10s <i class="fas fa-forward"></i>
                        </div>

                        <!-- Custom Controls -->
                        <div class="custom-controls" id="customControls">
                            <div class="progress-container">
                                <div class="progress-bar" id="progressBar">
                                    <div class="buffered-bar" id="bufferedBar"></div>
                                    <div class="progress-filled" id="progressFilled"></div>
                                </div>
                            </div>
                            <div class="controls-row">
                                <div class="controls-left">
                                    <button class="control-btn play-btn" id="playPauseBtn">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="control-btn" id="skipBackBtn" title="Skip back 10s">
                                        <i class="fas fa-backward"></i>
                                    </button>
                                    <button class="control-btn" id="skipForwardBtn" title="Skip forward 10s">
                                        <i class="fas fa-forward"></i>
                                    </button>
                                    <div class="volume-control">
                                        <button class="control-btn" id="muteBtn">
                                            <i class="fas fa-volume-up"></i>
                                        </button>
                                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1">
                                    </div>
                                    <span class="time-display">
                                        <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                                    </span>
                                </div>
                                <div class="controls-right">
                                    <div class="speed-control desktop-only">
                                        <button class="control-btn" id="speedBtn" title="Playback speed">
                                            <i class="fas fa-tachometer-alt"></i>
                                        </button>
                                        <div class="speed-menu" id="speedMenu">
                                            <div class="speed-option" data-speed="0.25">0.25x</div>
                                            <div class="speed-option" data-speed="0.5">0.5x</div>
                                            <div class="speed-option" data-speed="0.75">0.75x</div>
                                            <div class="speed-option active" data-speed="1">Normal</div>
                                            <div class="speed-option" data-speed="1.25">1.25x</div>
                                            <div class="speed-option" data-speed="1.5">1.5x</div>
                                            <div class="speed-option" data-speed="1.75">1.75x</div>
                                            <div class="speed-option" data-speed="2">2x</div>
                                        </div>
                                    </div>
                                    <div class="settings-control">
                                        <button class="control-btn" id="settingsBtn" title="Settings">
                                            <i class="fas fa-cog"></i>
                                        </button>
                                        <div class="settings-menu" id="settingsMenu">
                                            <div class="settings-section">
                                                <div class="settings-title">üîä Audio Track</div>
                                                <div class="settings-options" id="audioTrackOptions">
                                                    <div class="settings-option active" data-track="-1">Default</div>
                                                </div>
                                            </div>
                                            <div class="settings-section">
                                                <div class="settings-title">üìù Subtitles</div>
                                                <div class="settings-options" id="subtitleOptions">
                                                    <div class="settings-option active" data-track="-1">Off</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="control-btn desktop-only" id="pipBtn" title="Picture in Picture">
                                        <i class="fas fa-external-link-square-alt"></i>
                                    </button>
                                    <button class="control-btn" id="fullscreenBtn" title="Fullscreen">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="shortcuts-hint">
                    <strong>Keyboard:</strong> Space = Play/Pause | ‚Üê ‚Üí = Skip 10s | ‚Üë ‚Üì = Volume | F = Fullscreen | M = Mute
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- File Information -->
                <div class="info-card">
                    <h3><i class="fas fa-info-circle"></i> File Information</h3>
                    <div class="file-name">{{ FileName }}</div>
                    <div class="file-details">
                        <div class="detail-row">
                            <span class="detail-label">Size</span>
                            <span class="detail-value">{{ FileSize }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Type</span>
                            <span class="detail-value">{{ MimeType }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Quality</span>
                            <span class="detail-value" id="videoQuality">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="info-card">
                    <h3><i class="fas fa-download"></i> Actions</h3>
                    <div class="action-buttons">
                        <a href="{{ DownloadURL }}" class="action-btn primary" download>
                            <i class="fas fa-download"></i> Download
                        </a>
                        <button class="action-btn secondary" onclick="openShareModal()">
                            <i class="fas fa-share-alt"></i> Share
                        </button>
                        <a href="{{ TelegramBotURL }}" class="action-btn secondary full-width" target="_blank">
                            <i class="fab fa-telegram"></i> Get in Telegram
                        </a>
                    </div>
                </div>

                <!-- External Players -->
                <div class="info-card external-players">
                    <h3><i class="fas fa-play-circle"></i> Open in Player (Android)</h3>
                    <div class="player-links">
                        <a href="intent://{{ StreamURLNoProtocol }}#Intent;package=com.mxtech.videoplayer.ad;type=video/*;scheme=http;end" class="player-link">
                            <img src="/assets/mxplayer.png" alt="MX Player">
                            <span>MX Player</span>
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                        <a href="intent://{{ StreamURLNoProtocol }}#Intent;package=org.videolan.vlc;type=video/*;scheme=http;end" class="player-link">
                            <img src="/assets/vlcplayer.png" alt="VLC">
                            <span>VLC Player</span>
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                </div>

                <!-- Disclaimer -->
                <div class="disclaimer">
                    <h4><i class="fas fa-exclamation-triangle"></i> Copyright Notice</h4>
                    <p>This service is for personal use only. Please respect copyright laws and the rights of content creators. Sharing copyrighted content without permission is prohibited. The admin is not responsible for any misuse of this service.</p>
                </div>

                <!-- Support Link -->
                <a href="{{ SupportURL }}" class="support-link" target="_blank">
                    <i class="fab fa-telegram"></i>
                    Contact Admin / Support
                </a>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-share-alt"></i> Share</h3>
                <button class="modal-close" onclick="closeShareModal()">&times;</button>
            </div>
            <div class="share-buttons">
                <a href="#" class="share-btn whatsapp" id="whatsappShare">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp</span>
                </a>
                <a href="#" class="share-btn telegram" id="telegramShare">
                    <i class="fab fa-telegram"></i>
                    <span>Telegram</span>
                </a>
                <a href="#" class="share-btn twitter" id="twitterShare">
                    <i class="fab fa-twitter"></i>
                    <span>Twitter</span>
                </a>
                <a href="#" class="share-btn facebook" id="facebookShare">
                    <i class="fab fa-facebook-f"></i>
                    <span>Facebook</span>
                </a>
            </div>
            <div class="copy-link">
                <input type="text" id="shareLink" value="{{ StreamURL }}" readonly>
                <button onclick="copyLink()">Copy</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">Link copied!</div>

    <script>
        const video = document.getElementById('videoPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const centerPlay = document.getElementById('centerPlay');
        const progressBar = document.getElementById('progressBar');
        const progressFilled = document.getElementById('progressFilled');
        const bufferedBar = document.getElementById('bufferedBar');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const volumeSlider = document.getElementById('volumeSlider');
        const muteBtn = document.getElementById('muteBtn');
        const speedBtn = document.getElementById('speedBtn');
        const speedMenu = document.getElementById('speedMenu');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const pipBtn = document.getElementById('pipBtn');
        const playerContainer = document.getElementById('playerContainer');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const customControls = document.getElementById('customControls');
        const skipBackIndicator = document.getElementById('skipBackIndicator');
        const skipForwardIndicator = document.getElementById('skipForwardIndicator');

        let controlsTimeout;

        // Format time
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            if (hrs > 0) {
                return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Play/Pause
        function togglePlay() {
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        }

        video.addEventListener('play', () => {
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            centerPlay.classList.remove('show');
            centerPlay.innerHTML = '<i class="fas fa-pause"></i>';
        });

        video.addEventListener('pause', () => {
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            centerPlay.classList.add('show');
            centerPlay.innerHTML = '<i class="fas fa-play"></i>';
        });

        // Click handlers with proper event handling
        playPauseBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            togglePlay();
        });
        
        centerPlay.addEventListener('click', (e) => {
            e.stopPropagation();
            togglePlay();
        });
        
        // Only toggle play when clicking directly on the video, not on controls
        video.addEventListener('click', (e) => {
            if (e.target === video) {
                togglePlay();
            }
        });

        // Time update
        video.addEventListener('timeupdate', () => {
            const percent = (video.currentTime / video.duration) * 100;
            progressFilled.style.width = `${percent}%`;
            currentTimeEl.textContent = formatTime(video.currentTime);
        });

        video.addEventListener('loadedmetadata', () => {
            durationEl.textContent = formatTime(video.duration);
            loadingOverlay.style.display = 'none';
            
            // Update video quality info
            const quality = video.videoHeight ? `${video.videoHeight}p` : 'Unknown';
            document.getElementById('videoQuality').textContent = quality;
        });

        // Buffered progress
        video.addEventListener('progress', () => {
            if (video.buffered.length > 0) {
                const buffered = video.buffered.end(video.buffered.length - 1);
                const percent = (buffered / video.duration) * 100;
                bufferedBar.style.width = `${percent}%`;
            }
        });

        // Progress bar click/touch handling for smooth seeking
        let isSeeking = false;
        
        function seekToPosition(clientX) {
            const rect = progressBar.getBoundingClientRect();
            const percent = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
            video.currentTime = percent * video.duration;
            progressFilled.style.width = `${percent * 100}%`;
        }
        
        progressBar.addEventListener('click', (e) => {
            e.stopPropagation();
            seekToPosition(e.clientX);
        });
        
        // Touch events for smooth mobile seeking
        progressBar.addEventListener('touchstart', (e) => {
            e.stopPropagation();
            isSeeking = true;
            if (e.touches.length > 0) {
                seekToPosition(e.touches[0].clientX);
            }
        }, { passive: false });
        
        progressBar.addEventListener('touchmove', (e) => {
            if (isSeeking && e.touches.length > 0) {
                e.preventDefault();
                e.stopPropagation();
                seekToPosition(e.touches[0].clientX);
            }
        }, { passive: false });
        
        progressBar.addEventListener('touchend', (e) => {
            e.stopPropagation();
            isSeeking = false;
        });
        
        // Mouse drag for desktop
        progressBar.addEventListener('mousedown', (e) => {
            isSeeking = true;
            seekToPosition(e.clientX);
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isSeeking) {
                seekToPosition(e.clientX);
            }
        });
        
        document.addEventListener('mouseup', () => {
            isSeeking = false;
        });

        // Volume
        volumeSlider.addEventListener('input', (e) => {
            e.stopPropagation();
            video.volume = e.target.value;
            updateVolumeIcon();
        });

        muteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            video.muted = !video.muted;
            updateVolumeIcon();
        });

        function updateVolumeIcon() {
            if (video.muted || video.volume === 0) {
                muteBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            } else if (video.volume < 0.5) {
                muteBtn.innerHTML = '<i class="fas fa-volume-down"></i>';
            } else {
                muteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            }
        }

        // Speed control
        speedBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            speedMenu.classList.toggle('active');
        });

        document.querySelectorAll('.speed-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const speed = parseFloat(option.dataset.speed);
                video.playbackRate = speed;
                document.querySelectorAll('.speed-option').forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                speedMenu.classList.remove('active');
            });
        });

        document.addEventListener('click', (e) => {
            if (!speedBtn.contains(e.target) && !speedMenu.contains(e.target)) {
                speedMenu.classList.remove('active');
            }
        });

        // Fullscreen
        fullscreenBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                playerContainer.requestFullscreen().catch(err => {
                    // Fallback for mobile
                    if (video.webkitEnterFullscreen) {
                        video.webkitEnterFullscreen();
                    }
                });
            }
        });

        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
            } else {
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
            }
        });

        // Picture in Picture
        pipBtn.addEventListener('click', async (e) => {
            e.stopPropagation();
            try {
                if (document.pictureInPictureElement) {
                    await document.exitPictureInPicture();
                } else {
                    await video.requestPictureInPicture();
                }
            } catch (error) {
                console.error('PiP error:', error);
            }
        });

        // Skip buttons
        document.getElementById('skipBackBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            video.currentTime = Math.max(0, video.currentTime - 10);
            showSkipIndicator('left');
        });

        document.getElementById('skipForwardBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            video.currentTime = Math.min(video.duration, video.currentTime + 10);
            showSkipIndicator('right');
        });

        function showSkipIndicator(direction) {
            const indicator = direction === 'left' ? skipBackIndicator : skipForwardIndicator;
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 500);
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            
            switch(e.key.toLowerCase()) {
                case ' ':
                    e.preventDefault();
                    togglePlay();
                    break;
                case 'arrowleft':
                    video.currentTime = Math.max(0, video.currentTime - 10);
                    showSkipIndicator('left');
                    break;
                case 'arrowright':
                    video.currentTime = Math.min(video.duration, video.currentTime + 10);
                    showSkipIndicator('right');
                    break;
                case 'arrowup':
                    e.preventDefault();
                    video.volume = Math.min(1, video.volume + 0.1);
                    volumeSlider.value = video.volume;
                    updateVolumeIcon();
                    break;
                case 'arrowdown':
                    e.preventDefault();
                    video.volume = Math.max(0, video.volume - 0.1);
                    volumeSlider.value = video.volume;
                    updateVolumeIcon();
                    break;
                case 'f':
                    fullscreenBtn.click();
                    break;
                case 'm':
                    video.muted = !video.muted;
                    updateVolumeIcon();
                    break;
            }
        });

        // Double tap to skip (mobile) - only on video area, not controls
        let lastTap = 0;
        let tapTimeout;
        
        // Function to check if touch is on control elements
        function isTouchOnControls(e) {
            const target = e.target;
            // Check if target is within controls
            if (customControls.contains(target) || 
                centerPlay.contains(target) || 
                target.closest('.control-btn') ||
                target.closest('.speed-menu') ||
                target.closest('.volume-control')) {
                return true;
            }
            return false;
        }
        
        // Add touch event listeners to control buttons to stop propagation
        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('touchstart', (e) => e.stopPropagation(), { passive: true });
            btn.addEventListener('touchend', (e) => e.stopPropagation());
        });
        
        // Note: Progress bar touch handling is handled above with isSeeking flag
        
        // Volume slider touch handling
        volumeSlider.addEventListener('touchstart', (e) => e.stopPropagation(), { passive: true });
        volumeSlider.addEventListener('touchend', (e) => e.stopPropagation());
        volumeSlider.addEventListener('touchmove', (e) => e.stopPropagation(), { passive: true });
        
        // Speed menu touch handling
        speedMenu.addEventListener('touchstart', (e) => e.stopPropagation(), { passive: true });
        speedMenu.addEventListener('touchend', (e) => e.stopPropagation());
        
        // Center play button touch
        centerPlay.addEventListener('touchend', (e) => {
            e.stopPropagation();
            e.preventDefault();
            togglePlay();
        });
        
        // Handle double tap to skip on video only
        video.addEventListener('touchend', (e) => {
            // Don't handle if this was a multi-touch gesture
            if (e.touches && e.touches.length > 0) return;
            
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            
            clearTimeout(tapTimeout);
            
            if (tapLength < 300 && tapLength > 0) {
                // Double tap detected
                const rect = playerContainer.getBoundingClientRect();
                const x = e.changedTouches[0].clientX - rect.left;
                const middle = rect.width / 2;
                
                if (x < middle) {
                    video.currentTime = Math.max(0, video.currentTime - 10);
                    showSkipIndicator('left');
                } else {
                    video.currentTime = Math.min(video.duration, video.currentTime + 10);
                    showSkipIndicator('right');
                }
                e.preventDefault();
            } else {
                // Single tap - wait to see if it becomes a double tap
                tapTimeout = setTimeout(() => {
                    togglePlay();
                }, 300);
            }
            lastTap = currentTime;
        });

        // Show/hide controls
        function showControls() {
            customControls.classList.add('active');
            clearTimeout(controlsTimeout);
            controlsTimeout = setTimeout(() => {
                if (!video.paused) {
                    customControls.classList.remove('active');
                }
            }, 3000);
        }

        playerContainer.addEventListener('mousemove', showControls);
        playerContainer.addEventListener('touchstart', showControls);

        // Loading states
        video.addEventListener('waiting', () => {
            loadingOverlay.style.display = 'flex';
        });

        video.addEventListener('canplay', () => {
            loadingOverlay.style.display = 'none';
        });

        // Share Modal
        function openShareModal() {
            document.getElementById('shareModal').classList.add('active');
            updateShareLinks();
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        function updateShareLinks() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('Check out this video: {{ FileName }}');
            
            document.getElementById('whatsappShare').href = `https://wa.me/?text=${text}%20${url}`;
            document.getElementById('telegramShare').href = `https://t.me/share/url?url=${url}&text=${text}`;
            document.getElementById('twitterShare').href = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
            document.getElementById('facebookShare').href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
        }

        function copyLink() {
            const input = document.getElementById('shareLink');
            input.select();
            document.execCommand('copy');
            showToast('Link copied to clipboard!');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Close modal on overlay click
        document.getElementById('shareModal').addEventListener('click', (e) => {
            if (e.target.id === 'shareModal') {
                closeShareModal();
            }
        });

        // Settings menu (speed, audio, subtitles)
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsMenu = document.getElementById('settingsMenu');
        const audioTrackOptions = document.getElementById('audioTrackOptions');
        const subtitleOptions = document.getElementById('subtitleOptions');
        const speedOptions = document.getElementById('speedOptions');
        
        settingsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            settingsMenu.classList.toggle('active');
            speedMenu.classList.remove('active');
        });
        
        // Speed options in settings menu (for mobile)
        speedOptions.querySelectorAll('.speed-opt').forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const speed = parseFloat(option.dataset.speed);
                video.playbackRate = speed;
                
                // Update both speed menus (desktop dropdown and settings menu)
                document.querySelectorAll('.speed-option').forEach(opt => opt.classList.remove('active'));
                document.querySelectorAll('.speed-opt').forEach(opt => opt.classList.remove('active'));
                document.querySelectorAll(`[data-speed="${speed}"]`).forEach(opt => opt.classList.add('active'));
                
                // Close settings menu on mobile after selection
                if (window.innerWidth <= 768) {
                    settingsMenu.classList.remove('active');
                }
            });
        });
        
        // Detect and populate audio tracks
        video.addEventListener('loadedmetadata', () => {
            // Audio tracks
            if (video.audioTracks && video.audioTracks.length > 0) {
                audioTrackOptions.innerHTML = '';
                for (let i = 0; i < video.audioTracks.length; i++) {
                    const track = video.audioTracks[i];
                    const option = document.createElement('div');
                    option.className = 'settings-option' + (track.enabled ? ' active' : '');
                    option.dataset.track = i;
                    option.textContent = track.label || track.language || `Audio ${i + 1}`;
                    option.addEventListener('click', (e) => {
                        e.stopPropagation();
                        selectAudioTrack(i);
                    });
                    audioTrackOptions.appendChild(option);
                }
            }
            
            // Text tracks (subtitles)
            if (video.textTracks && video.textTracks.length > 0) {
                subtitleOptions.innerHTML = '<div class="settings-option active" data-track="-1">Off</div>';
                for (let i = 0; i < video.textTracks.length; i++) {
                    const track = video.textTracks[i];
                    const option = document.createElement('div');
                    option.className = 'settings-option';
                    option.dataset.track = i;
                    option.textContent = track.label || track.language || `Subtitle ${i + 1}`;
                    option.addEventListener('click', (e) => {
                        e.stopPropagation();
                        selectSubtitleTrack(i);
                    });
                    subtitleOptions.appendChild(option);
                }
            }
        });
        
        function selectAudioTrack(index) {
            if (video.audioTracks) {
                for (let i = 0; i < video.audioTracks.length; i++) {
                    video.audioTracks[i].enabled = (i === index);
                }
                // Update UI
                audioTrackOptions.querySelectorAll('.settings-option').forEach((opt, i) => {
                    opt.classList.toggle('active', i === index);
                });
            }
        }
        
        function selectSubtitleTrack(index) {
            if (video.textTracks) {
                for (let i = 0; i < video.textTracks.length; i++) {
                    video.textTracks[i].mode = (i === index) ? 'showing' : 'hidden';
                }
                // Update UI
                subtitleOptions.querySelectorAll('.settings-option').forEach((opt) => {
                    const trackIdx = parseInt(opt.dataset.track);
                    opt.classList.toggle('active', trackIdx === index);
                });
            }
        }
        
        // Off subtitles option click handler
        subtitleOptions.querySelector('[data-track="-1"]')?.addEventListener('click', (e) => {
            e.stopPropagation();
            if (video.textTracks) {
                for (let i = 0; i < video.textTracks.length; i++) {
                    video.textTracks[i].mode = 'hidden';
                }
            }
            subtitleOptions.querySelectorAll('.settings-option').forEach((opt) => {
                opt.classList.toggle('active', opt.dataset.track === '-1');
            });
        });
        
        // Close settings menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target)) {
                settingsMenu.classList.remove('active');
            }
        });
        
        // Touch support for settings menu
        settingsMenu.addEventListener('touchstart', (e) => e.stopPropagation(), { passive: true });
        settingsMenu.addEventListener('touchend', (e) => e.stopPropagation());

        // Initialize
        showControls();
    </script>
</body>
</html>

